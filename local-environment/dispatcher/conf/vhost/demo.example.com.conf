<VirtualHost *:80>
  ServerName demo.example.com
  DocumentRoot /opt/aem/dispatcher/cache/demo

  <Directory /opt/aem/dispatcher/cache/demo>
    <IfModule disp_apache2.c>
      SetHandler dispatcher-handler
      ModMimeUsePathInfo On
    </IfModule>
    Options FollowSymLinks
    AllowOverride None
    Require all granted
  </Directory>

  RewriteEngine On

  RewriteRule ^ - [E=PAGE_REQUEST:false]

  # Excludes from rewriting
  RewriteCond %{REQUEST_URI} !^/api/
  RewriteCond %{REQUEST_URI} !^/services
  RewriteCond %{REQUEST_URI} !^/apps
  RewriteCond %{REQUEST_URI} !^/bin
  RewriteCond %{REQUEST_URI} !^/content
  RewriteCond %{REQUEST_URI} !^/etc
  RewriteCond %{REQUEST_URI} !^/home/?$
  RewriteCond %{REQUEST_URI} !^/libs
  RewriteCond %{REQUEST_URI} !^/tmp
  RewriteCond %{REQUEST_URI} !^/var
  RewriteRule ^ - [E=PAGE_REQUEST:true]

  # Regular page redirect
  RewriteCond %{ENV:PAGE_REQUEST} ^true$
  RewriteRule ^/(.+)$ /content/example/demo/$1 [PT,L]

</VirtualHost>
